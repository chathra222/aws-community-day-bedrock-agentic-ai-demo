‚úÖ 1Ô∏è‚É£ Wire up GitHub Actions Secrets
Your .github/workflows/ci.yml needs:

AWS_ACCESS_KEY_ID

AWS_SECRET_ACCESS_KEY

AWS_REGION (if needed)

GITHUB_TOKEN (PAT ‚Äî Personal Access Token for PR creation)

üîë How to do it:

In GitHub, go to your repo ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions.

Click ‚ÄúNew repository secret‚Äù.

Add:

AWS_ACCESS_KEY_ID

AWS_SECRET_ACCESS_KEY

GITHUB_TOKEN (generate a classic token in your GitHub Account ‚Üí Developer settings ‚Üí Personal access tokens).

‚úÖ Tip:
Give your PAT repo + workflow + contents permissions so the Lambda can push + PR.

‚úÖ 2Ô∏è‚É£ Terraform Backend
Don‚Äôt store state locally ‚Äî use S3 + DynamoDB for safe remote state.

Add this to your terraform/main.tf (top of file):

hcl
Copy
Edit
terraform {
  backend "s3" {
    bucket         = "YOUR-TF-STATE-BUCKET"
    key            = "playwright-self-heal-agent/terraform.tfstate"
    region         = "ap-southeast-1"
    dynamodb_table = "YOUR-TF-LOCK-TABLE"
    encrypt        = true
  }
}
‚úÖ How to create S3 bucket & lock table:

bash
Copy
Edit
aws s3 mb s3://YOUR-TF-STATE-BUCKET
aws dynamodb create-table \
  --table-name YOUR-TF-LOCK-TABLE \
  --attribute-definitions AttributeName=LockID,AttributeType=S \
  --key-schema AttributeName=LockID,KeyType=HASH \
  --provisioned-throughput ReadCapacityUnits=5,WriteCapacityUnits=5
‚úÖ 3Ô∏è‚É£ Bedrock Agent & Lambda IAM Permissions
Ensure:

The Lambda role allows bedrock:InvokeAgent.

The Lambda has logs:CreateLogGroup, logs:CreateLogStream, logs:PutLogEvents.

Add inline to your IAM role:

hcl
Copy
Edit
resource "aws_iam_role_policy" "bedrock_invoke" {
  name = "BedrockInvokePolicy"
  role = aws_iam_role.lambda_role.id

  policy = jsonencode({
    Version = "2012-10-17",
    Statement = [{
      Effect = "Allow",
      Action = [
        "bedrock:InvokeAgent"
      ],
      Resource = "*"
    }]
  })
}
‚úÖ 4Ô∏è‚É£ Git Branch + PR Handling
Your Lambda uses PyGithub.
‚úÖ Be sure:

The PAT has repo scope.

The repo name is correct in handler.py:

python
Copy
Edit
repo = github.get_repo('YOUR_GITHUB_USER/YOUR_REPO')
‚úÖ The branch main matches your default branch.

‚úÖ 5Ô∏è‚É£ Deploy Lambda Correctly
When you terraform apply, you need to zip your handler:

bash
Copy
Edit
cd lambda
pip install -r requirements.txt -t .
zip -r lambda_function_payload.zip .
Copy the zip into terraform/ or adjust the filename path in main.tf accordingly.

‚úÖ 6Ô∏è‚É£ Test the Flow
When all wired:
1Ô∏è‚É£ terraform init && terraform apply
2Ô∏è‚É£ Push a broken Playwright test ‚Üí GitHub Actions runs ‚Üí test fails
3Ô∏è‚É£ Action triggers Lambda ‚Üí Bedrock fixes ‚Üí tries new test ‚Üí opens PR if passing.